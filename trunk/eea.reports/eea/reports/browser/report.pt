<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">


<metal:cssslot fill-slot="css_slot">
  <style type="text/css" media="all" tal:condition="exists: portal/reports_styles.css"
         tal:content="string:@import url($portal_url/reports_styles.css);">
  </style>
</metal:cssslot>

<body>

<div metal:fill-slot="main"
        tal:define="
        context_url string:${context/absolute_url};
        errors options/state/getErrors | nothing;
        Iterator python: modules['Products.Archetypes'].IndexIterator;
        tabindex tabindex|python: Iterator(pos=7000);
        schematas here/Schemata;
        fieldsets python: [key for key in schematas.keys() if key != 'metadata'];
        default_fieldset python:(not schematas or schematas.has_key('default')) and 'default' or fieldsets[0];
        fieldset request/fieldset|options/fieldset|default_fieldset;
        fields python: schematas[fieldset].editableFields(here);
        lockable python: hasattr(here, 'wl_isLocked');
        isLocked python: lockable and here.wl_isLocked();
        mode string:view;
">

    <h1>
        <span tal:replace="here/Title">Title of the Publication</span>
    </h1>
    <div class="documentActions languages">
        <tal:lang tal:condition="exists: here/global_languageselector">
            <metal:lang use-macro="here/global_languageselector/macros/language" />
        </tal:lang>
    </div>
    <div class="documentDescription" tal:define="
        field python:here.getField('serial_title');
        serial_title python:field.getAccessor(here)();
        serial_alt python:len(serial_title) > 3 and serial_title[3];
        vocab python:field.Vocabulary(here);">
        <tal:serial_alt condition="serial_alt" replace="serial_alt" />
        <tal:serial_title condition="not:serial_alt" tal:define="
            report_type python:len(serial_title) and serial_title[0];
            report_type python:report_type and here.translate(vocab.getMsgId(report_type),
                        default=vocab.getValue(report_type)) or report_type;
            report_num python:len(serial_title)>1 and serial_title[1];
            report_year python:len(serial_title)>2 and serial_title[2];"
            tal:replace="string:${report_type} No ${report_num}/${report_year}">
            Report No 7/2000
        </tal:serial_title>
    </div>

    <div class="figure-left" tal:define="cover here/getCoverImage|nothing"
        tal:condition="cover">
         <div class="figure"><img tal:attributes="
            src cover/absolute_url;
            alt cover/title_or_id;
            title cover/title_or_id" />
        </div>
    </div>

    <div class="publicationText">
        <div class="publicationDescription">
            <strong tal:content="here/Description" />
        </div>
        <ul class="visualNoMarker relatedLinks publicationThemes"  tal:define="
            field python:here.getField('themes');
            themes python:field.getAccessor(here)();
            vocab python:field.Vocabulary(here);"
            tal:condition="themes">
            <li tal:content="python:field.widget.Label(here)" />
            <li tal:repeat="theme themes">
                <a tal:define="
                    have_key python:theme in vocab.keys();
                    value python:have_key and here.translate(vocab.getMsgId(theme), default=vocab.getValue(theme)) or theme"
                    tal:attributes="href string:http://www.eea.europa.eu/themes/${theme}; title value"
                    tal:omit-tag="not:have_key" tal:content="value" />
                <span tal:condition="not:repeat/theme/end" tal:content="string:|" />
            </li>
        </ul>
        <div class="discreet">
            <tal:publishdate metal:use-macro="here/document_byline/macros/publishdate" />
        </div>

        <div class="publicationFile" tal:define="
            field python:here.getField('file');
            value python:field.getAccessor(here)()"
            tal:condition="python:value and value.get_size()">

            <a href="" tal:attributes="href string:${here/absolute_url}/at_download/file">
                <img tal:attributes="src string:${here/absolute_url}/pdf.png" />
                <strong i18n:domain="eea.reports"
                       i18n:translate="label_download_full_publication">Download the full publication as PDF</strong>
            </a>
            <span tal:content="python:'[%s]' % value.getObjSize(value)" />
        </div>

        <p class="documentByLine"> Published by: </p>
        <ul tal:define="
            field python:here.getField('publishers');
            publishers python:field.getAccessor(here)();
            vocab python:field.Vocabulary(here);">
            <li tal:repeat="publisher publishers">
                <tal:publishers tal:define="
                    have_key python:publisher in vocab.keys();
                    value python:have_key and here.translate(vocab.getMsgId(publisher), default=vocab.getValue(publisher)) or publisher"
                    tal:replace="value" />
            </li>
        </ul>

        <!-- Additional files content -->
        <tal:foldercontents define="
            folderContents python:here.getFolderContents({'portal_type': 'File'});"
            condition="folderContents">
        <h2>Additional content - Free download</h2>
        <ul>
            <li tal:repeat="item folderContents">
            <tal:file define="
                item_type item/portal_type;
                item_wf_state item/review_state|python: wtool.getInfoFor(item, 'review_state', '');
                item_wf_state_class  python:'state-' + normalizeString(item_wf_state);
                item_state_title python:wtool.getTitleForStateOnType(item_wf_state, item_type);
                item_object item/getObject|item;
                item_title_or_id item/pretty_title_or_id;">
                <a tal:attributes="
                    class item_wf_state_class;
                    href item_object/absolute_url;
                    title item_title_or_id">
                    <img tal:define="icon python:item_object.getIcon(1)"
                        tal:attributes="src string:${portal_url}/${icon}" alt="item_title_or_id" />
                    <span tal:content="item_title_or_id" />
                </a>
                <span tal:content="python:'[%s]' % item_object.getObjSize(item_object)" />
            </tal:file>
            </li>
        </ul>
        </tal:foldercontents>

        <!-- Additional links content -->
        <tal:foldercontents define="
            folderContents python:here.getFolderContents({'portal_type': 'Link'});"
            condition="folderContents">
        <h2>Links</h2>
        <ul>
            <li tal:repeat="item folderContents">
            <tal:link define="
                item_type item/portal_type;
                item_wf_state item/review_state|python: wtool.getInfoFor(item, 'review_state', '');
                item_wf_state_class  python:'state-' + normalizeString(item_wf_state);
                item_state_title python:wtool.getTitleForStateOnType(item_wf_state, item_type);
                item_object item/getObject|item;
                item_title_or_id item/pretty_title_or_id;">
                <a tal:attributes="
                    class item_wf_state_class;
                    href item_object/remote_url;
                    title item_title_or_id">
                    <img tal:define="icon python:item_object.getIcon(1)"
                        tal:attributes="src string:${portal_url}/${icon}" alt="item_title_or_id" />
                    <span tal:content="item_title_or_id" />
                </a>
            </tal:link>
            </li>
        </ul>
        </tal:foldercontents>

        <tal:order define="
            oid_field       python:here.getField('order_id');
            oid_value       python:oid_field.getAccessor(here)();
            fs_field        python:here.getField('for_sale');
            fs_value        python:fs_field.getAccessor(here)();
            isbn_filed      python:here.getField('isbn');
            isbn_value      python:isbn_filed.getAccessor(here)();
            price_field     python:here.getField('price');
            price_value     python:price_field.getAccessor(here)();
            oo_field        python:here.getField('order_override_text');
            oo_value        python:oo_field.getAccessor(here)();
            oe_field        python:here.getField('order_extra_text');
            oe_value        python:oe_field.getAccessor(here)();"
            tal:condition="fs_value">

        <h2 i18n:translate="help_order_id">Order a printed copy of this document</h2>

        <tal:order_default condition="not:oo_value">
        <div class="publicationOrder">
            <div class="publicationField" style="float:left">
                <div>
                    <label for="isbn_filed.name" title="The widget's hint"
                           tal:attributes="
                               for python:isbn_filed.widget.Label(here);
                               title python:isbn_filed.widget.Label(here)"
                           tal:content="python:isbn_filed.widget.Label(here)"></label>:
                    <span tal:content="isbn_value" />
                </div>
                <div>
                    <label for="oid_field.name" title="The widget's hint"
                           tal:attributes="
                               for python:oid_field.widget.Label(here);
                               title python:oid_field.widget.Label(here)"
                           tal:content="python:oid_field.widget.Label(here)"></label>:
                    <span tal:content="oid_value" />
                </div>
                <div>
                    <label for="price_field.name" title="The widget's hint"
                           tal:attributes="
                               for python:price_field.widget.Label(here);
                               title python:price_field.widget.Label(here)"
                           tal:content="python:price_field.widget.Label(here)"></label>:
                    <span tal:content="python:'EUR %.02f' % (price_value or 0)" />
                </div>
            </div>

            <div style="float:left" class="publicationOrderButton">
               <a href=""
                      target="_blank"
                      alt="Order a printed copy at EU-Bookshop"
                      tal:attributes="href string:http://bookshop.europa.eu/eGetRecords?Template=en_search_identifiers" >
                          <img src="eu_bookshop.gif"
                               alt="EU Bookshop: You can order a printed copy of this document"
                               title="EU Bookshop: You can order a printed copy of this document">
               </a>
            </div>
            <div class="visualClear"></div>
        </div>
        <div>
            <strong i18n:translate="nearst_locations_label">You can also obtain a copy from</strong>
            <a href="/sales_agent_redirect" i18n:translate="nearst_locations_link">your nearest sales agent</a>
        </div>
        </tal:order_default>
        <tal:order_override tal:condition="oo_value">
            <div tal:content="structure oo_value">Order override text</div>
        </tal:order_override>
        <tal:order_extra tal:condition="oe_value">
            <div tal:content="structure oe_value">Order extra text</div>
        </tal:order_extra>
        </tal:order>
        <tal:trailer define="
            tr_field python:here.getField('trailer');
            tr_value python:tr_field.getAccessor(here)();">
            <div tal:content="structure tr_value">Trailer</div>
        </tal:trailer>
    </div>

    <br clear="all" />
</div>

</body>
</html>
